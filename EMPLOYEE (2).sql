drop database employee;
CREATE DATABASE EMPLOYEE;
USE EMPLOYEE;
CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    PRIMARY KEY (EMPNO, INCENTIVE_DATE),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PLOC VARCHAR(50),
    PNAME VARCHAR(50)
);


CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

INSERT INTO DEPT VALUES
(5,'IT','BANGLORE'),
(6,'FINANCE','GOA'),
(7,'MARKETING','CHENNAI'),
(8,'DESIGNING','MUMBAI'),
(9,'HR','DELHI');

INSERT INTO EMPLOYEE VALUES
(101,'RAVI',null,'2020-06-10',50000,5),
(102,'PRIYA',101,'2020-01-15',30000,5),
(103,'ARJUN',101,'2019-09-01',30000,6),
(104,'MEENA',102,'2022-03-20',48000,7),
(105,'KIRAN',103,'2023-11-05',45000,8);

INSERT INTO INCENTIVES VALUES
(101,'2024-03-01',5000),
(102,'2024-05-10',3000),
(103,'2024-07-15',25000),
(104,'2024-09-20',2000),
(105,'2024-10-01',1500);

INSERT INTO PROJECT VALUES
(201,'BANGLORE','PAYROLL SYSTEM'),
(202,'GOA','INVENTORYAPP'),
(203,'CHENNAI','CRM DEVELOPMENT'),
(204,'MUMBAI','BUDJET TRACKER'),
(205,'DELHI','MARKETING PORTAL');

INSERT  INTO ASSIGNED_TO VALUES
(101,201,'MANAGER'),
(102,202,'DEVELOPER'),
(103,202,'TESTER'),
(104,204,'ANALYST'),
(105,205,'DESIGNER');

SELECT DISTINCT E.EMPNO 
FROM EMPLOYEE E
JOIN ASSIGNED_TO A ON E.EMPNO
JOIN PROJECT P ON A.PNO=P.PNO
WHERE P.PLOC IN('BANGLORE','CHENNAI','GOA');

SELECT E.EMPNO FROM EMPLOYEE E WHERE E.EMPNO IN (SELECT INCENTIVES.EMPNO FROM INCENTIVES WHERE INCENTIVE_DATE=NULL);

SELECT E.EMPNO,E.ENAME,D.DNAME,A.JOB_ROLE,D.DLOC,P.PLOC
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO=D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO=A.EMPNO
JOIN PROJECT P ON A.PNO=P.PNO
WHERE D.DLOC=P.PLOC;


select e1.ename from employee e1 where e1.empno=(select e.mgr_no from employee e
group by e.mgr_no order by count(e.empno) desc limit 1);

select e.ename from employee e where e.sal>(select avg(e.sal) from employee where e.empno=e.mgr_no group by e.mgr_no ) ;

 select e1.ename from employee e1 where e1.empno=(select mgr_no from employee e group by mgr_no  order by count(e.empno) desc limit 1);
 
 select * from incentives where incentive_date between '2024-03-01' and '2024-03-31' order by incentive_amount desc; 
 
 select e1.ename as manager_name ,e2.ename as employee_name,e1.deptno from  employee e1
 join employee e2 on e1.empno=e2.mgr_no where e1.deptno=e2.deptno;